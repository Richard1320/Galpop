/**
 * Galpop Image Gallery Popup
 * http://galpop.magicmediamuse.com/
 *
 * Author
 * Richard Hung
 * http://www.magicmediamuse.com/
 *
 * Version
 * 1.0.2
 * 
 * Copyright (c) 2014 Richard Hung.
 * 
 * License
 * Galpop Image Gallery Popup by Richard Hung is licensed under a Creative Commons Attribution-NonCommercial 3.0 Unported License.
 * http://creativecommons.org/licenses/by-nc/3.0/deed.en_US
 */


(function(e){var t={init:function(t){var r={arrowKeys:true,controls:true,loop:true,maxWidth:null,maxHeight:null,maxScreen:90,updateRsz:true,callback:null,lockScroll:true};var t=e.extend({},r,t);return this.click(function(r){n.data({arrowKeys:t.arrowKeys,controls:t.controls,loop:t.loop,maxWidth:t.maxWidth,maxHeight:t.maxHeight,maxScreen:t.maxScreen,updateRsz:t.updateRsz,callback:t.callback,lockScroll:t.lockScroll});e(this).galpop("openBox");r.preventDefault()})},openBox:function(){var t=this.data("galpop-group");var r=e('[data-galpop-group="'+t+'"]');var i=r.index(this);var s=n.data("arrowKeys");var o=n.data("updateRsz");var u=n.data("lockScroll");if(s){e(document).bind("keydown",f)}if(o){e(window).resize(l)}if(u){e("html").addClass("lock-scroll")}n.fadeIn(500,"swing");n.data({rel:t,group:r,index:i,status:true,count:r.length});this.galpop("preload");return this},closeBox:function(){n.fadeOut(500,"swing",function(){i.find("img").remove();s.hide().contents().remove();e(this).data("status",false);o.hide();u.hide();e(document).unbind("keydown",f);e(window).unbind("resize",l);e("html").removeClass("lock-scroll")})},preload:function(){var e=this.attr("href");image=new Image;image.src=e;image.onload=function(){n.galpop("display")};image.onerror=function(){console.log(e+" contains a broken image!")};return this},display:function(){var t=image.height;var s=image.width;var o=n.data("maxWidth");var u=n.data("maxHeight");var a=n.data("maxScreen");var f=e(window).height();var l=e(window).width();var c=0;var h=r.outerWidth()-r.width();var p=r.outerHeight()-r.height();if(!o||o>l*a/100){o=l*a/100}if(!u||u>f*a/100){u=f*a/100}if(s>o){c=o/s;t=t*c;s=s*c}if(t>u){c=u/t;s=s*c;t=t*c}r.css({height:t,width:s});setTimeout(function(){i.append(image).find("img").height(t).width(s).fadeIn(500,"swing",function(){n.galpop("complete")})},500)},complete:function(){var t=n.data("controls");var r=n.data("callback");var i=n.data("index");var i=n.data("index");var s=n.data("count");var a=n.data("loop");n.galpop("infoParse");if(!t||i==0&&!a||s<=1){o.hide()}else{o.show()}if(!t||i+1>=s&&!a||s<=1){u.hide()}else{u.show()}if(e.isFunction(r)){r.call(this)}},moveItem:function(t){var r=n.data("group");s.fadeOut(500,"swing",function(){e(this).contents().remove()});i.find("img").fadeOut(500,"swing",function(){e(this).remove();r.eq(t).galpop("preload");n.data("index",t)});return this},next:function(){var e=n.data("index");var t=n.data("loop");var r=n.data("group");var i=n.data("count");if(e+1<i){e++;n.galpop("moveItem",e)}else if(t){e=0;n.galpop("moveItem",e)}return this},prev:function(){var e=n.data("index");var t=n.data("loop");var r=n.data("group");var i=n.data("count");if(e>0){e--;n.galpop("moveItem",e)}else if(t){e=i-1;n.galpop("moveItem",e)}return this},infoParse:function(){var t=n.data("index");var r=n.data("group");var i=r.eq(t);var o=e.trim(i.attr("title"));var u=e.trim(i.data("galpop-link"));var a=e.trim(i.data("galpop-link-title"));var f=e.trim(i.data("galpop-link-target"));s.html("");if(o!=""){e("<p>"+o+"</p>").appendTo(s)}if(u!=""){if(a==""){a=u}if(f!=""){f='target="'+f+'"'}e('<p><a href="'+u+'" '+f+">"+a+"</a></p>").appendTo(s)}if(o!=""||u!=""){s.fadeIn(500,"swing")}},update:function(){var e=n.data("index");n.galpop("moveItem",e);return this},destroy:function(){return this.unbind("click")}};e.fn.galpop=function(n){if(t[n]){return t[n].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){return t.init.apply(this,arguments)}else{e.error("Method "+n+" does not exist on jQuery.galpop")}};var n,r,i,s,o,u,a,f,l;e(document).ready(function(){n=e('<div id="galpop-wrapper" />').prependTo("body");r=e('<div id="galpop-container" />').appendTo(n);i=e('<div id="galpop-content" />').appendTo(r);s=e('<div id="galpop-info" />').appendTo(i);o=e('<a href="#" id="galpop-prev" />').appendTo(i);u=e('<a href="#" id="galpop-next" />').appendTo(i);a=e('<a href="#" id="galpop-close" />').appendTo(i);n.click(function(t){e(this).galpop("closeBox");t.preventDefault()});r.click(function(e){e.stopPropagation()});o.hide().click(function(e){n.galpop("prev");e.preventDefault()});u.hide().click(function(e){n.galpop("next");e.preventDefault()});a.click(function(e){n.galpop("closeBox");e.preventDefault()});s.on("click","a",function(){n.galpop("closeBox")});f=function(e){var t=e.which;switch(t){case 27:n.galpop("closeBox");break;case 37:n.galpop("prev");break;case 39:n.galpop("next");break}e.preventDefault()};l=function(){n.galpop("update")}})})(jQuery)